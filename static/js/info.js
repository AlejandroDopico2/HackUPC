const form = document.getElementById("form");
const inputFile = document.getElementById("file");

const handleSubmit = async (event) => {
    event.preventDefault();

    const imagesInBase64 = ["data:image_jpeg;base64,_9j_4AAQSkZJRgABAQAAAQABAAD_2wEEEAGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjSEQGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjS_8IAEQgAyAEsAwEiAAIRAQMRAf_EACkAAQEBAAAAAAAAAAAAAAAAAAABAgEBAQAAAAAAAAAAAAAAAAAAAAH_2gAMAwEAAhADEAAAAKAAAAACKIAAAKAABAAAAUCkipQAlAAAEsAAAAoAAAAUiiUEqIQqC3NKgoAEsAAAoAoiyIoihZQACNDM0iSyholAAAAAAAABmwAqC2CkEsNoC5LNZFlBSKJLCgELAWQ1AWBLIAWClqAgjaKubCwBRYKgQAJYKUiiAAgCUCFgqKsqCKqCoKgqCoLZSAIKAAABKIozQCCiKDNoAAABZRZSAzYNM0soiiLTLQlQudQigIAgoICgJULcjTIqCpSKLYKgqCoLAASgAIQqKEoigUiiKIolAAAogAAgKAAAKIohSLAAAAAAAAQoBCgAEioqoNAQAAAAAAAAAACUSwCABQQoAoAAAAAAAAAACAAACFAAK__EABwQAQABBAMAAAAAAAAAAAAAABEAAUBgcDBQgP_aAAgBAQABPwDxtTmcZe0dOOHEIXpCF4Q17__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQIBAT8Ad__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQMBAT8Ad__Z", "data:image_jpeg;base64,_9j_4AAQSkZJRgABAQAAAQABAAD_2wEEEAGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjSEQGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjS_8IAEQgAyAEsAwEiAAIRAQMRAf_EACkAAQEBAAAAAAAAAAAAAAAAAAABAgEBAQAAAAAAAAAAAAAAAAAAAAH_2gAMAwEAAhADEAAAAKAAAAACKIAAAKAABAAAAUCkipQAlAAAEsAAAAoAAAAUiiUEqIQqC3NKgoAEsAAAoAoiyIoihZQACNDM0iSyholAAAAAAAABmwAqC2CkEsNoC5LNZFlBSKJLCgELAWQ1AWBLIAWClqAgjaKubCwBRYKgQAJYKUiiAAgCUCFgqKsqCKqCoKgqCoLZSAIKAAABKIozQCCiKDNoAAABZRZSAzYNM0soiiLTLQlQudQigIAgoICgJULcjTIqCpSKLYKgqCoLAASgAIQqKEoigUiiKIolAAAogAAgKAAAKIohSLAAAAAAAAQoBCgAEioqoNAQAAAAAAAAAACUSwCABQQoAoAAAAAAAAAACAAACFAAK__EABwQAQABBAMAAAAAAAAAAAAAABEAAUBgcDBQgP_aAAgBAQABPwDxtTmcZe0dOOHEIXpCF4Q17__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQIBAT8Ad__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQMBAT8Ad__Z", "data:image_jpeg;base64,_9j_4AAQSkZJRgABAQAAAQABAAD_2wEEEAGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjSEQGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjS_8IAEQgAyAEsAwEiAAIRAQMRAf_EACkAAQEBAAAAAAAAAAAAAAAAAAABAgEBAQAAAAAAAAAAAAAAAAAAAAH_2gAMAwEAAhADEAAAAKAAAAACKIAAAKAABAAAAUCkipQAlAAAEsAAAAoAAAAUiiUEqIQqC3NKgoAEsAAAoAoiyIoihZQACNDM0iSyholAAAAAAAABmwAqC2CkEsNoC5LNZFlBSKJLCgELAWQ1AWBLIAWClqAgjaKubCwBRYKgQAJYKUiiAAgCUCFgqKsqCKqCoKgqCoLZSAIKAAABKIozQCCiKDNoAAABZRZSAzYNM0soiiLTLQlQudQigIAgoICgJULcjTIqCpSKLYKgqCoLAASgAIQqKEoigUiiKIolAAAogAAgKAAAKIohSLAAAAAAAAQoBCgAEioqoNAQAAAAAAAAAACUSwCABQQoAoAAAAAAAAAACAAACFAAK__EABwQAQABBAMAAAAAAAAAAAAAABEAAUBgcDBQgP_aAAgBAQABPwDxtTmcZe0dOOHEIXpCF4Q17__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQIBAT8Ad__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQMBAT8Ad__Z", "data:image_jpeg;base64,_9j_4AAQSkZJRgABAQAAAQABAAD_2wEEEAGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjSEQGQAZABkAGQAakBkAHCAfQB9AHCAnECowJYAqMCcQOdA1IDBwMHA1IDnQV4A-gEMwPoBDMD6AV4CE0FLQYOBS0FLQYOBS0ITQdTCOMHOga9BzoI4wdTDS8KWgkuCS4KWg0vDzwMywwcDMsPPBJ1EIEQgRJ1Fz4WEhc-Hl8eXyjS_8IAEQgAyAEsAwEiAAIRAQMRAf_EACkAAQEBAAAAAAAAAAAAAAAAAAABAgEBAQAAAAAAAAAAAAAAAAAAAAH_2gAMAwEAAhADEAAAAKAAAAACKIAAAKAABAAAAUCkipQAlAAAEsAAAAoAAAAUiiUEqIQqC3NKgoAEsAAAoAoiyIoihZQACNDM0iSyholAAAAAAAABmwAqC2CkEsNoC5LNZFlBSKJLCgELAWQ1AWBLIAWClqAgjaKubCwBRYKgQAJYKUiiAAgCUCFgqKsqCKqCoKgqCoLZSAIKAAABKIozQCCiKDNoAAABZRZSAzYNM0soiiLTLQlQudQigIAgoICgJULcjTIqCpSKLYKgqCoLAASgAIQqKEoigUiiKIolAAAogAAgKAAAKIohSLAAAAAAAAQoBCgAEioqoNAQAAAAAAAAAACUSwCABQQoAoAAAAAAAAAACAAACFAAK__EABwQAQABBAMAAAAAAAAAAAAAABEAAUBgcDBQgP_aAAgBAQABPwDxtTmcZe0dOOHEIXpCF4Q17__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQIBAT8Ad__EABQRAQAAAAAAAAAAAAAAAAAAAHD_2gAIAQMBAT8Ad__Z"]
    // const imagesInBase64 = await Promise.all(
    //     Array.from(inputFile.files)
    //         .map(imageToBase64)
    // )

    const body = {
        images: imagesInBase64,
        bathroom: document.getElementById("bathroom").value,
        bedrooms: document.getElementById("bedrooms").value,
        meters: document.getElementById("meters").value,
        zip: document.getElementById("zip").value,
    }

    const response = await fetch('http://127.0.0.1:5000/results', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json;charset=utf-8'
        },
        body: JSON.stringify(body)
      });
      
    const scores = await response.json();
};

form.addEventListener("submit", handleSubmit);

async function imageToBase64(imageBlob) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader()
        reader.onloadend = () => resolve(reader.result)
        reader.onerror = reject
        reader.readAsDataURL(imageBlob)
    })
}